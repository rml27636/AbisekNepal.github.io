<!DOCTYPE html>
<html data-wf-page="6726c65c4a28a6de28d0da3b" data-wf-site="67256188a1a3be620e19fb0b">
<head>
  <meta charset="utf-8">
  <title>Browse</title>
  <meta content="Browse" property="og:title">
  <meta content="Browse" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/lendit-0694eb.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic","Righteous:regular","Cormorant Infant:300,regular","Rubik:regular,500,600,700,800,900,italic"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <section class="header">
    <div class="w-layout-blockcontainer container w-container">
      <div class="text-block">LendIt.</div>
    </div>
  </section>
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-3 w-nav">
    <div class="container-4 w-container">
      <nav role="navigation" class="nav-menu w-nav-menu">
        <a href="index.html" class="nav-link-5 home-button w-nav-link">Home</a>
        <a href="browse.html" aria-current="page" class="nav-link-5 browse-button w-nav-link w--current">Browse</a>
        <a href="about.html" class="nav-link-5 about-button w-nav-link">About</a>
        <a href="login-page.html" class="nav-link-5 login-button w-nav-link">Login</a>
      </nav>
      <div class="w-nav-button">
        <div class="w-icon-nav-menu"></div>
      </div>
    </div>
  </div>
  <section class="section">
    <div class="w-layout-blockcontainer container-5 w-container">
      <div class="w-form">
        <form id="email-form" name="email-form" data-name="Email Form" method="get" class="form-3" data-wf-page-id="6726c65c4a28a6de28d0da3b" data-wf-element-id="7fcc4e00-f892-f8b5-6d66-9862bbc47fa8"><input class="text-field-2 w-input" maxlength="256" name="Item" data-name="Item" placeholder="Search Items" type="text" id="Item" required=""><input type="submit" data-wait="Please wait..." class="submit-button w-button" value="Search"></form>
        <div class="w-form-done">
          <div>Thank you! Your submission has been received!</div>
        </div>
        <div class="w-form-fail">
          <div>Oops! Something went wrong while submitting the form.</div>
        </div>
      </div>
    </div>
  </section>
  <div class="efi-ftr-05">
    <div class="efi-ftr-05-container">
      <div class="efi-ftr-05-footer-horizontal">
        <div class="efi-ftr-05-footer-block">
          <div class="text-block">LendIt.</div>
          <h2>Browse Items</h2>
      <div id="items-container" class="items-grid"></div>
        <div class="efi-ftr-05-link-wrap">
          <a href="index.html" class="efi-footer-link-centre">Home</a>
          <a href="about.html" class="efi-footer-link-centre">About</a>
          <a href="browse.html" aria-current="page" class="efi-footer-link-centre w--current">Browse</a>
          <a href="login-page.html" class="efi-footer-link-centre">Login</a>
          <a href="sign-up.html" class="efi-footer-link-centre">Signup</a>
        </div>
        <div class="efi-ftr-05-footer-block">
          <div class="efi-text-rights-short">Copyright Â© 2024. LendIt.</div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=67256188a1a3be620e19fb0b" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script>
    // Load items from the API
    let allItems = []; // Store all items globally for filtering

    $.getJSON('http://127.0.0.1:5000/api/items', function (items) {
      allItems = items; // Save the items to the global variable
      displayItems(items); // Display all items initially
    }).fail(function () {
      $('#items-container').html('<p>Failed to load items. Please try again later.</p>');
    });

    // Function to display items
    function displayItems(items) {
      const itemsContainer = $('#items-container');
      itemsContainer.empty(); // Clear the container

      if (items.length === 0) {
        itemsContainer.html('<p>No items found</p>');
      } else {
        items.forEach(item => {
          const itemHtml = `
            <div class="efi-ft-01-cell">
              <a href="rentalRequest.html?itemId=${item.id}&itemName=${encodeURIComponent(item.name)}&itemDescription=${encodeURIComponent(item.description)}&ownerId=${encodeURIComponent(item.ownerId)}&ownerName=${encodeURIComponent(item.owner)}&itemPrice=${item.price}" class="efi-ft-01-item-link">
                <div class="efi-ft-01-image-wrapper">
                  <img src="${item.imageUrl || 'default-image.jpg'}" alt="${item.name}" class="image-2 unsplash-image">
                </div>
                <div class="efi-ft-01-feature-wrapper">
                  <h4 class="efi-h4-2">${item.name}</h4>
                  <p class="efi-paragraph">
                    Age: ${item.age}<br>
                    Owner: ${item.owner || 'Unknown'}<br>
                    Location: ${item.location}<br>
                    Description: ${item.description}<br>
                    Price: $${item.price} ${item.pricePer || ''}
                  </p>
                  
                </div>
              </a>
              </div>
              <div class="review-form">
                    <label for="rating-${item.id}">Rating (1-5):</label>
                    <input type="number" id="rating-${item.id}" name="rating" min="1" max="5" required><br>

                    <label for="comment-${item.id}">Comment:</label>
                    <textarea id="comment-${item.id}" name="comment" required></textarea><br>

                    <button type="button" class="submit-review" data-item-id="${item.id}">Submit Review</button>
                  </div>

                  <!-- Reviews for this item -->
                  <div class="reviews-container" id="reviews-${item.id}">
                    <!-- Reviews will be appended here dynamically -->
                  </div>
            </div>
          `;
          itemsContainer.append(itemHtml);
          fetchReviews(item.id);
        });
      }
    }

    // Add search functionality
    $('#email-form').on('submit', function (e) {
      e.preventDefault(); // Prevent the form from reloading the page
      const searchTerm = $('#Item').val().trim().toLowerCase(); // Get the user's search term

      if (searchTerm) {
        // Filter items based on the search term
        const filteredItems = allItems.filter(item =>
          item.name.toLowerCase().includes(searchTerm) ||
          item.description.toLowerCase().includes(searchTerm) ||
          item.location.toLowerCase().includes(searchTerm)
        );

        displayItems(filteredItems); // Update the displayed items
      } else {
        displayItems(allItems); // Show all items if the search term is empty
      }
    });

    // Handle review submission
  // Handle review submission using fetch
  document.addEventListener('click', function (event) {
    if (event.target && event.target.classList.contains('submit-review')) {
      const itemId = event.target.getAttribute('data-item-id');
      const rating = document.getElementById(`rating-${itemId}`).value;
      const comment = document.getElementById(`comment-${itemId}`).value;

      if (rating && comment) {
        const reviewData = {
          item_id: itemId,
          rating: rating,
          comment: comment
        };

        fetch('http://127.0.0.1:5000/api/review/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(reviewData)
        })
        .then(response => response.json())
        .then(data => {
          if (data.message === 'Review submitted successfully!') {
            alert('Review submitted successfully!');
            fetchReviews(itemId); // Refresh the reviews for this item
          } else {
            alert('Failed to submit review. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error submitting review:', error);
          alert('An error occurred while submitting the review.');
        });
      } else {
        alert('Please provide both rating and comment.');
      }
    }
  });

  // Fetch reviews for a specific item
  function fetchReviews(itemId) {
    fetch(`http://127.0.0.1:5000/api/review/${itemId}`)
      .then(response => response.json())
      .then(reviews => {
        const reviewsContainer = document.getElementById(`reviews-${itemId}`);
        reviewsContainer.innerHTML = ''; // Clear previous reviews

        if (reviews.length === 0) {
          reviewsContainer.innerHTML = '<p>No reviews yet.</p>';
        } else {
          reviews.forEach(review => {
            const reviewHtml = `
              <div class="review">
                <p><strong>Rating:</strong> ${review.rating} / 5</p>
                <p><strong>Comment:</strong> ${review.comment}</p>
              </div>
            `;
            reviewsContainer.innerHTML += reviewHtml;
          });
        }
      })
      .catch(error => {
        console.error('Error fetching reviews:', error);
        document.getElementById(`reviews-${itemId}`).innerHTML = '<p>Failed to load reviews. Please try again later.</p>';
      });
  }

  // Fetch and display reviews for each item on page load
  document.addEventListener('DOMContentLoaded', function () {
    const items = document.querySelectorAll('.efi-ft-01-item-link');
    items.forEach(item => {
      const itemId = item.getAttribute('data-item-id');
      fetchReviews(itemId);
    });
  });
  </script>
</body>
</html>
</body>
</html>
